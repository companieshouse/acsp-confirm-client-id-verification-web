{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set errors = pageProperties.errors %}

{% extends "layouts/default.njk" %}

{% set title = i18n.dateOfBirthTitle %}
{% block main_content %}

  {% set errorPrefix = "dob" %}
  {% if errors[errorPrefix + "-day"] %}
    {% set errorMessageText = errors[errorPrefix + "-day"].text %}
  {% elif errors[errorPrefix + "-month"] %}
    {% set errorMessageText = errors[errorPrefix + "-month"].text %}
  {% elif errors[errorPrefix + "-year"] %}
    {% set errorMessageText = errors[errorPrefix + "-year"].text %}
  {% endif %}
  {% if errorMessageText %}
    {% set dateError = true %}
  {% else %}
    {% set dateError = false %}
  {% endif %}

  <div>
    <form action="{{ currentUrl }}?lang={{ lang }}" method="POST">
      {% include "partials/csrf_token.njk" %}
      {% if reqType !== "reverify" %}
        {% include "partials/user_name.njk" %}
      {% else %}
        <span class="govuk-caption-l name-header">{{ personFullName }}</span>
      {% endif %}

      <div class="govuk-form-group {% if dateError %}govuk-form-group--error{% endif %}">
        <fieldset class="govuk-fieldset">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
            <h1 class="govuk-fieldset__heading">
              {{ i18n.dateOfBirthTitle }}
            </h1>
          </legend>
          {% if i18n.dateOfBirthHint %}
            <div id="dob-hint" class="govuk-hint govuk-!-margin-bottom-6">{{ i18n.dateOfBirthHint }}</div>
          {% endif %}
          {% if dateError %}
            <span class="govuk-error-message">
              <span class="govuk-visually-hidden">Error:</span> {{ errorMessageText }}
            </span>
          {% endif %}

          <div class="govuk-date-input" id="dob">
            <div class="govuk-date-input__item">
              <div class="govuk-form-group">
                <label class="govuk-label govuk-date-input__label" for="dob-day">
                  {{ i18n.day }}
                </label>
                <input class="govuk-input govuk-date-input__input govuk-input--width-2{% if dateError %} govuk-input--error{% endif %}"
                       id="dob-day"
                       name="dob-day"
                       value="{{ payload["dob-day"] | default('') }}" type="text" inputmode="numeric" maxlength="2">
              </div>
            </div>
            <div class="govuk-date-input__item">
              <div class="govuk-form-group">
                <label class="govuk-label govuk-date-input__label" for="dob-month">
                  {{ i18n.month }}
                </label>
                <input class="govuk-input govuk-date-input__input govuk-input--width-2{% if dateError %} govuk-input--error{% endif %}"
                       id="dob-month"
                       name="dob-month"
                       value="{{ payload["dob-month"] | default('') }}" type="text" inputmode="numeric" maxlength="2">
              </div>
            </div>
            <div class="govuk-date-input__item">
              <div class="govuk-form-group">
                <label class="govuk-label govuk-date-input__label" for="dob-year">
                  {{ i18n.year }}
                </label>
                <input class="govuk-input govuk-date-input__input govuk-input--width-4{% if dateError %} govuk-input--error{% endif %}"
                       id="dob-year"
                       name="dob-year"
                       value="{{ payload["dob-year"] | default('') }}" type="text" inputmode="numeric" maxlength="4">
              </div>
            </div>
          </div>
        </fieldset>
        <div class="govuk-warning-text govuk-!-margin-top-6">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <strong class="govuk-warning-text__text">
          <span class="govuk-visually-hidden">{{ i18n.warning }}</span>
          {{ i18n.dateOfBirthWarningText }}
          </strong>
        </div>

        <div class="govuk-!-margin-top-6 govuk-!-margin-bottom-6">

          {% set checkboxConfig = {
              name: "confirmCorrectDateOfBirthEntered",
              fieldset: {
                  legend: {
                      text: i18n.confirmCorrectDateOfBirthHeading,
                      isPageHeading: false,
                      classes: "govuk-fieldset__legend--m"
                  },
                  attributes: {
                      "data-event-id": "confirm-correct-dob-entered"
                  }
              },
              items: [
                  {
                      value: "true",
                      text: i18n.confirmCorrectDateOfBirthEntered + " " + firstName + " " + lastName + ".",
                      id: "confirm-correct-dob-entered",
                      label: {
                          classes: "govuk-label govuk-checkboxes__label govuk-!-text-break-word"
                      }
                  }
              ]
          } %}

        {% if errors and errors.confirmCorrectDateOfBirthEntered %}
            {{ govukCheckboxes({
                name: checkboxConfig.name,
                fieldset: checkboxConfig.fieldset,
                items: checkboxConfig.items,
                errorMessage: {
                    text: errors.confirmCorrectDateOfBirthEntered.text
                }
            }) }}
        {% else %}
            {{ govukCheckboxes(checkboxConfig) }}
        {% endif %}

      </div>

      {{ govukButton({
        text: i18n.Continue,
        id: "continue-button"
      }) }}
    </form>
  </div>

{% endblock main_content %}