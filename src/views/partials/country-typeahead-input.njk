<script type="text/javascript" src="{{cdnHost}}/javascripts/app/accessible-autocomplete.min.js"></script> 
<script type="text/javascript"> 

document.addEventListener("DOMContentLoaded", function() { 
const countryList = "{{ countryList }}".split(";"); 
const autocompleteContainers = document.querySelectorAll('[id^="my-autocomplete-container-"]'); 

autocompleteContainers.forEach((container, index) => { 
const countryDefaultValue = "{{ payload['countryInput_' + (index + 1)] }}"; 
const formGroup = document.getElementById(`typeahead-form-group-${index + 1}`); 
const errorText = "{{ errors['countryInput_' + (index + 1)].text }}";
      accessibleAutocomplete({ 
      element: container, 
      id: `countryInput_${index + 1}`, 
      source: countryList, 
      name: `countryInput_${index + 1}`, 
      defaultValue: countryDefaultValue 
 }); 
 
 
// Mimic nunjucks error generation
 /*if (errorText) { 
      formGroup.classList.add("govuk-form-group--error");
      const errorHtml = `<p class="govuk-error-message"> <span class="govuk-visually-hidden">Error:</span> ${errorText} </p>`; 
      const hintElement = formGroup.querySelector(`#typeahead-hint-${index + 1}`); 
      hintElement.insertAdjacentHTML("afterend", errorHtml); 
    
      const autocompleteInput = document.getElementById(`countryInput_${index + 1}`); 
      if (autocompleteInput) { 
      autocompleteInput.classList.add("govuk-input--error"); 
      } 
    } */
  }); 
  }); 
</script>
